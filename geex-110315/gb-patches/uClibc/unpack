#!/bin/sh

. config/options

$SCRIPTS/unpack linux

UCLIBC=`ls -d $BUILD/$1*`

sed -i -e "s|^HOSTCC[[:space:]]*=.*$|HOSTCC = $HOST_CC|" \
       -e "s|^CROSS[[:space:]]*=.*$|CROSS = $TARGET_PREFIX|" \
       $UCLIBC/Rules.mak

sed -e "s%^KERNEL_SOURCE=.*%KERNEL_SOURCE=\"$(kernel_path)\"%" \
    $PACKAGES/$1/config/$1.$TARGET_ARCH.conf > $UCLIBC/.config

[ "$DEVTOOLS" = yes ] && cat $PACKAGES/$1/config/$1.devtools.conf >> $UCLIBC/.config

make -C $UCLIBC oldconfig
make -C $UCLIBC pregen

rm -rf "$SYSROOT_PREFIX/usr/include"
make -C $UCLIBC PREFIX="$SYSROOT_PREFIX" install_dev
